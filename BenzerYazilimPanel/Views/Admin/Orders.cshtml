@{
    ViewBag.Title = "Orders";
    Layout = "~/Views/AdminShared/Master.cshtml";
}
<script src="~/Content/plugins/select2/select2.min.js"></script>
<link href="~/Content/plugins/select2/select2.css" rel="stylesheet" />
<script src="~/Scripts/jquery.printElement.min.js"></script>
<script src="~/Scripts/printThis.js"></script>
<script type="text/javascript">

	function SiparisSil(id) {
        var r = confirm("Siparişi silerseniz bir daha geri gelmez. Silmek istediğinizden emin misiniz?");
        if (r == true) {
            $.ajax({
                type: "POST",
                url: '@(Url.Action("SiparisSil", "Admin"))',
                async: false,
                data: JSON.stringify({ id: id }),
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    if (data == true) {
                        alert("Silme işlemi başarılı...");
                        BilgileriDoldur(mevcutSayfa);
                    }
                    else {
                        alert("Silme işlemi başarısız...Lütfen tekrar deneyiniz.");
                    }
                },
                error: function (ddd) {
                    alert("Silme işlemi başarısız...Lütfen tekrar deneyiniz.");
                }
            });
        }
    }
    


    $(document).ready(function () {
        SahisDoldur();
        BilgileriDoldur(1,-1);

        $("#drpBayiler").change(function () {
            
            BilgileriDoldur(1,$("#drpBayiler").val());


        });
		
		    

        $("#btnKaydetMailAt").click(function () {

            $.ajax({
                url: '@Url.Action("SaveOrder","Admin")', //your server side script, //our data
                type: 'POST',
                async: false,
                data: JSON.stringify({ Urunler: Urunler, adet: ToplamAdet, AraToplam: AraToplam, Vergi: VergiTutari, Komisyon: Iskonto, GenelToplam: GenelToplam }),
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    if (data.status == true) {
                        alert("Kaydetme başarılı");
                        //location.reload();
                        $("#ayrintiBtn").click();
                        AyrintiDoldur(data.deger);


                    }
                    else {
                        alert("Kaydetme başarısız");
                    }

                }
            });


        });

        $("#btnYazdir").click(function () {
            AyrintiDoldur2($("#hiddenIDCikti").val());
            $("#PAdivTumVeriler").printThis();
        });

        $("#btnMailAt").click(function () {
            $("#mailAtBtn").click();
            AyrintiDoldur2($("#hiddenIDCikti").val());
        });

        $("#btnMailGonder").click(function () {
            var mailler = $("#txtMailAdresleri").val();
            var icerik = $("#PAdivTumVeriler").html();

            if (mailler == "") {
                alert("Lütfen adres giriniz");
                return;
            }

            $.ajax({
                url: '@Url.Action("MailGonder","Admin")', //your server side script, //our data
                type: 'POST',
                async: false,
                data: JSON.stringify({ mail: mailler, icerik: icerik }),
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    if (data == true) {
                        alert("Mail Gönderme Başarılı");
                        //$("#btnMailKapat").click();
                    }
                    else {
                        alert("Kaydetme başarısız");
                    }

                }
            });
        });


    });

    function AyrintiDoldur2(ID) {
        $.ajax({
            url: '@Url.Action("GetOrderProducts","Admin")', //your server side script, //our data
            type: 'POST',
            async: false,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify({ ID: ID }),
            success: function (data) {
                if (data) {
                    $("#PAeklenenUrunler").empty();
                    $.each(data.urunler, function (index, item) {
                        $("#PAeklenenUrunler").append('<tr style="display: table-row;vertical-align: inherit;border-color: inherit;"> <td></td> <td style="border: 1px solid #ddd;padding: 8px;line-height: 1.42857143;vertical-align: top;display: table-cell;">' + item.Name + '</td><td style="border: 1px solid #ddd;padding: 8px;line-height: 1.42857143;vertical-align: top;display: table-cell;">' + (item.Not == null ? "" : item.Not) + '</td> <td style="border: 1px solid #ddd;padding: 8px;line-height: 1.42857143;vertical-align: top;display: table-cell;text-align:right">' + item.Adet + '</td> <td  style="border: 1px solid #ddd;padding: 8px;line-height: 1.42857143;vertical-align: top;display: table-cell;text-align: right">' + item.Price + ' €' + '</td> <td style="border: 1px solid #ddd;padding: 8px;line-height: 1.42857143;vertical-align: top;display: table-cell;text-align: right">' + item.GenelToplam + ' €' + '</td> </tr>');
                    });

                    $("#PAtoplamAdet").html(data.GenelBilgiler.Adet);
                    $("#PAaraToplam").html(data.GenelBilgiler.AraToplam + " €");
                    $("#PAvergiTutari").html(data.GenelBilgiler.Vergi + " €");
                    $("#PAvergiDahil").html(data.GenelBilgiler.VergiDahil + " €");
                    $("#PATextIskonto").html(data.GenelBilgiler.Komisyon + " €");
                    $("#PAgenelToplam").html(data.GenelBilgiler.GenelToplam + " €");
                    $("#PATextKomisyonOran").html(data.GenelBilgiler.KomisyonOran);
                }

            },
            error: function () {

            }
        });
    }
    
    function SahisDoldur()
    {
        $.ajax({
            url: '@Url.Action("GetSahislarHepsi", "Admin")', //your server side script, //our data
            type: 'POST',
            async: false,
            success: function (data) {

                $("#drpBayiler").empty();
                $("#drpBayiler").append('<option value="-1">Tümü</option>');
                $.each(data, function (index, item) {
                    $("#drpBayiler").append('<option value="' + item.ID + '">' + item.Text + '</option>');
                });
                $("#drpBayiler").select2();

            },
            error: function () {

            }
        });
    }

    function AyrintiDoldur(ID)
    {
        $.ajax({
            url: '@Url.Action("GetOrderProducts","Admin")', //your server side script, //our data
            type: 'POST',
            async: false,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify({ ID: ID }),
            success: function (data) {
                if (data)
                {
                $("#eklenenUrunler").empty();
                $.each(data.urunler, function (index, item) {
                    $("#eklenenUrunler").append('<tr> <td></td> <td>' + item.Name + '</td><td>' + (item.Not == null ? "" : item.Not) + '</td> <td> <table style="width: 100%"> <tbody> <tr> <td style="width: 20%; text-align: center"></td> <td style="width: 60%; text-align: center"> <span style="font-size: 12px; text-align: center" >' + item.Adet + '</span> </td> <td style="width: 20%; text-align: center;"></td> </tr> </tbody> </table> </td> <td style="text-align: right">' + item.Price + ' €' + '</td> <td style="text-align: right">' + item.GenelToplam + ' €' + '</td> </tr>');
                });

                $("#toplamAdet").html(data.GenelBilgiler.Adet);
                $("#araToplam").html(data.GenelBilgiler.AraToplam + " €");
                $("#vergiTutari").html(data.GenelBilgiler.Vergi + " €");
                $("#vergiDahil").html(data.GenelBilgiler.VergiDahil + " €");
                $("#TextIskonto").html(data.GenelBilgiler.Komisyon + " €");
                $("#genelToplam").html(data.GenelBilgiler.GenelToplam + " €");
                $("#hiddenIDCikti").val(data.GenelBilgiler.ID);
                $("#TextKomisyonOrani").html(data.GenelBilgiler.KomisyonOran);
                }

            },
            error: function () {

            }
        });
    }

    function BilgileriDoldur(page,cari) {
        $.ajax({
            url: '@Url.Action("GetOrders","Admin")', //your server side script, //our data
            type: 'POST',
            async: false,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify({ pageLimit: 10, page: page, cari: cari }),
            success: function (data) {

                $("#ordersTable").empty();
                $.each(data.results, function (index, item) {
                    $("#ordersTable").append('<tr role="row" class="odd"><td class="sorting_1">' + (index + 1) + '</td><td>' + item.Tarih + '</td><td>' + item.Komisyon + '</td><td>' + item.Adet + '</td><td>' + item.Price + '</td><td><span class="label label-sm label-danger">' + item.Cari + '</span></td><td><a  data-toggle="modal" onclick="AyrintiDoldur(' + item.ID + ');" href="#tblAyrinti" class="btn btn-sm btn-circle btn-default btn-editable"><i class="fa fa-search"></i> View</a><a onclick="SiparisSil(' + item.ID + ');">Sil</a></td></tr>');
                });
                
                mevcutSayfa = page;
                var total = data.total;
                var sayfaSayisi = Math.round(parseInt(total) / 9);
                if (sayfaSayisi * 9 < parseInt(total)) {
                    sayfaSayisi++;
                }

                $("#UlSayfalama").empty();
                if (parseInt(total) > 0 && mevcutSayfa != 1) {
                    $("#UlSayfalama").append('<li> <a href="javascript:;" onclick="BilgileriDoldur(parseInt(mevcutSayfa) - 1,$(\'#drpBayiler\').val());"> <i class="fa fa-angle-left"></i> </a> </li>');
                }

                for (var i = 0; i < sayfaSayisi; i++) {
                    if (i + 1 == mevcutSayfa) {
                        $("#UlSayfalama").append('<li class="active"> <a href="javascript:;" onclick="BilgileriDoldur(' + (i + 1) + ',$(\'#drpBayiler\').val());"> ' + (i + 1) + '</a> </li>');
                    }
                    else {
                        $("#UlSayfalama").append('<li> <a href="javascript:;" onclick="BilgileriDoldur(' + (i + 1) + ',$(\'#drpBayiler\').val());"> ' + (i + 1) + '</a> </li>');
                    }

                };
                if (parseInt(total) > 0 && sayfaSayisi != mevcutSayfa) {
                    $("#UlSayfalama").append('<li> <a href="javascript:;" onclick="BilgileriDoldur(parseInt(mevcutSayfa) + 1,$(\'#drpBayiler\').val());"> <i class="fa fa-angle-right"></i> </a> </li>');
                }

            },
            error: function () {

            }
        });
    }

</script>

<h2>Orders</h2>

<div class="row">
    <div class="col-md-12">
        <div class="note note-info">
            <p>Not: Aşağıdan şahıs ve bayi seçerek filtreleme yapabilirsiniz. </p>
        </div>
        <!-- Begin: life time stats -->
        <div class="portlet light portlet-fit portlet-datatable bordered">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-settings font-green"></i>
                    <span class="caption-subject font-green sbold uppercase">Sipariş Listesi </span>
                </div>
                <div class="actions">
                </div>
            </div>
            <div class="portlet-body">
                <div class="table-container">

                    <div id="datatable_orders_wrapper" class="dataTables_wrapper dataTables_extended_wrapper no-footer">
                        <div class="row" style="margin-bottom:15px">
                        <div class="col-md-2">Şahış/Bayi Seçin:</div>
                        <div class="col-md-10"><select id="drpBayiler" class="form-control select2" style="width:100%"></select></div>
                            
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover table-checkable dataTable no-footer" id="datatable_orders" aria-describedby="datatable_orders_info" role="grid">
                                <thead>
                                    <tr role="row" class="heading">

                                        <th width="5%" class="sorting_asc" tabindex="0" aria-controls="datatable_orders" rowspan="1" colspan="1" aria-sort="ascending" aria-label="">Order&nbsp;# </th>
                                        <th width="15%" class="sorting" tabindex="0" aria-controls="datatable_orders" rowspan="1" colspan="1" aria-label="">Tarih </th>
                                        <th width="15%" class="sorting" tabindex="0" aria-controls="datatable_orders" rowspan="1" colspan="1" aria-label="">Komisyon </th>

                                        <th width="10%" class="sorting" tabindex="0" aria-controls="datatable_orders" rowspan="1" colspan="1" aria-label="">Adet </th>
                                        <th width="10%" class="sorting" tabindex="0" aria-controls="datatable_orders" rowspan="1" colspan="1" aria-label="">Toplam </th>
                                        <th width="10%" class="sorting" tabindex="0" aria-controls="datatable_orders" rowspan="1" colspan="1" aria-label="">Şahıs/Bayi </th>
                                        <th width="10%" class="sorting" tabindex="0" aria-controls="datatable_orders" rowspan="1" colspan="1" aria-label="">Actions </th>
                                    </tr>
                                </thead>
                                <tbody id="ordersTable">
                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-12" style="text-align:center">
                            <ul class="pagination pagination-sm" id="UlSayfalama"></ul>



                        </div>
                        <div class="clearfix"></div>
                        <div class="row">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End: life time stats -->
    </div>
</div>


<div class="modal fade bs-modal-lg" id="tblAyrinti" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title"><b>Sipariş Detayı: </b> </h4>
            </div>
            <div class="modal-body">
                <div class="portlet-body" id="divTumVeriler">
                    <div class="table-responsive">
                        <table class="table table-hover table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th style="width:5%">#</th>
                                    <th style="width:40%"> Ürün </th>
                                    <th style="width: 40%"> Not </th>
                                    <th style="width:20%"> Adet </th>
                                    <th style="width:15%"> Birim Fiyat </th>
                                    <th style="width:20%"> Toplam Tutar </th>

                                </tr>
                            </thead>
                            <tbody id="eklenenUrunler">
                               
                            </tbody>
                        </table>
                    </div>
                    <div class="well">
                        <div class="row static-info align-reverse">
                            <div class="col-md-9 name">Toplam Adet: </div>
                            <div class="col-md-3 value"><span id="toplamAdet"></span></div>
                        </div>
                        <div class="row static-info align-reverse">
                            <div class="col-md-9 name">Ara Toplam: </div>
                            <div class="col-md-3 value"><span id="araToplam"></span></div>
                        </div>
                        <div class="row static-info align-reverse">
                            <div class="col-md-9 name">Vergi Tutarı(%19): </div>
                            <div class="col-md-3 value"><span id="vergiTutari"></span></div>
                        </div>
                        <div class="row static-info align-reverse">
                            <div class="col-md-9 name">Vergi Dahil: </div>
                            <div class="col-md-3 value"><span id="vergiDahil"></span></div>
                        </div>
                        <div class="row static-info align-reverse">
                            <div class="col-md-9 name">İskonto(%<span id="TextKomisyonOrani"></span>): </div>
                            <div class="col-md-3 value"><span id="TextIskonto"></span></div>
                        </div>
                        <div class="row static-info align-reverse">
                            <div class="col-md-9 name">Genel Toplam: </div>
                            <div class="col-md-3 value"><span id="genelToplam"></span></div>
                        </div>
                    </div>
                    <input type="hidden" id="hiddenIDCikti" />
                    <div class="clearfix"></div>
                </div>
                <div class="clearfix"></div>
            </div>
            <div class="modal-footer">
                <button type="button" id="btnKategoriKapat" class="btn default" data-dismiss="modal">Kapat</button>
                <button type="button" id="btnMailAt" class="btn default" data-dismiss="modal">Mail At</button>
                <button type="button" id="btnYazdir" class="btn default" data-dismiss="modal">Yazdır</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<div style="visibility:hidden">
    <div class="portlet-body" id="PAdivTumVeriler" style="clear: both;padding: 0;line-height: 1.42857143">
        <div class="table-responsive" style="margin-top:50px">
            <table class="table table-hover table-bordered table-striped" style="border: 1px solid #ddd;width: 100%;max-width: 100%;margin-bottom: 20px;border-spacing: 0;border-collapse: collapse;display: table;">
                <thead style="display: table-header-group;vertical-align: middle;border-color: inherit;">
                    <tr style="display: table-row;vertical-align: inherit;border-color: inherit;">
                        <th style="width: 5%;border-bottom: 0;border: 1px solid #ddd;padding: 8px;line-height: 1.42857143;text-align: left;display: table-cell;">#</th>
                        <th style="width: 40%;border-bottom: 0;border: 1px solid #ddd;padding: 8px;line-height: 1.42857143;text-align: left;display: table-cell;">Ürün </th>
                        <th style="width: 40%;border-bottom: 0;border: 1px solid #ddd;padding: 8px;line-height: 1.42857143;text-align: left;display: table-cell;">Not </th>
                        <th style="width: 20%;border-bottom: 0;border: 1px solid #ddd;padding: 8px;line-height: 1.42857143;text-align: left;display: table-cell;">Adet </th>
                        <th style="width: 15%;border-bottom: 0;border: 1px solid #ddd;padding: 8px;line-height: 1.42857143;text-align: left;display: table-cell;">Birim Fiyat </th>
                        <th style="width: 20%;border-bottom: 0;border: 1px solid #ddd;padding: 8px;line-height: 1.42857143;text-align: left;display: table-cell;">Toplam Tutar </th>

                    </tr>
                </thead>
                <tbody id="PAeklenenUrunler" style="display: table-row-group;vertical-align: middle;border-color: inherit;"></tbody>
            </table>
        </div>
        <div class="well" style="background-color: #eee;border: 0;-moz-box-shadow: none !important;box-shadow: none !important;min-height: 20px;padding: 19px;margin-bottom: 20px;">
            <div class="row static-info align-reverse" style="margin-bottom: 10px;margin-right: -15px;margin-left: -15px;">
                <div class="col-md-9 name" style="text-align: right;font-size: 14px;width: 75%;float: left;position: relative;min-height: 1px;padding-right: 0;padding-left: 0px;">Toplam Adet: </div>
                <div class="col-md-3 value" style="text-align: right;font-size: 14px;font-weight: 600;width: 25%;float:left;position: relative;min-height: 1px;padding-right: 0px;padding-left: 0px;"><span id="PAtoplamAdet"></span></div>
                <div style="clear: left;"></div>
            </div>
            <div class="row static-info align-reverse" style="margin-bottom: 10px;margin-right: -15px;margin-left: -15px;">
                <div class="col-md-9 name" style="text-align: right;font-size: 14px;width: 75%;float: left;position: relative;min-height: 1px;padding-right: 0px;padding-left: 0px;">Ara Toplam: </div>
                <div class="col-md-3 value" style="text-align: right;font-size: 14px;font-weight: 600;width: 25%;float:left;position: relative;min-height: 1px;padding-right: 0px;padding-left: 0px;"><span id="PAaraToplam"></span></div>
                <div style="clear: left;"></div>
            </div>
            <div class="row static-info align-reverse" style="margin-bottom: 10px;margin-right: -15px;margin-left: -15px;">
                <div class="col-md-9 name" style="text-align: right;font-size: 14px;width: 75%;float: left;position: relative;min-height: 1px;padding-right: 0px;padding-left: 0px;">Vergi Tutarı(%19): </div>
                <div class="col-md-3 value" style="text-align: right;font-size: 14px;font-weight: 600;width: 25%;float:left;position: relative;min-height: 1px;padding-right: 0px;padding-left: 0px;"><span id="PAvergiTutari"></span></div>
                <div style="clear: left;"></div>
            </div>
            <div class="row static-info align-reverse" style="margin-bottom: 10px;margin-right: -15px;margin-left: -15px;">
                <div class="col-md-9 name" style="text-align: right;font-size: 14px;width: 75%;float: left;position: relative;min-height: 1px;padding-right: 0px;padding-left: 0px;">Vergi Dahil: </div>
                <div class="col-md-3 value" style="text-align: right;font-size: 14px;font-weight: 600;width: 25%;float:left;position: relative;min-height: 1px;padding-right: 0px;padding-left: 0px;"><span id="PAvergiDahil"></span></div>
                <div style="clear: left;"></div>
            </div>
            <div class="row static-info align-reverse" style="margin-bottom: 10px;margin-right: -15px;margin-left: -15px;">
                <div class="col-md-9 name" style="text-align: right;font-size: 14px;width: 75%;float: left;position: relative;min-height: 1px;padding-right: 0px;padding-left: 0px;">İskonto(%<span id="PATextKomisyonOran"></span>): </div>
                <div class="col-md-3 value" style="text-align: right;font-size: 14px;font-weight: 600;width: 25%;float:left;position: relative;min-height: 1px;padding-right: 0px;padding-left: 0px;"><span id="PATextIskonto"></span></div>
                <div style="clear: left;"></div>
            </div>
            <div class="row static-info align-reverse" style="margin-bottom: 10px;margin-right: -15px;margin-left: -15px;">
                <div class="col-md-9 name" style="text-align: right;font-size: 14px;width: 75%;float: left;position: relative;min-height: 1px;padding-right: 0px;padding-left: 0px;">Genel Toplam: </div>
                <div class="col-md-3 value" style="text-align: right;font-size: 14px;font-weight: 600;width: 25%;float:left;position: relative;min-height: 1px;padding-right: 0px;padding-left: 0px;"><span id="PAgenelToplam"></span></div>
                <div style="clear: left;"></div>
            </div>
        </div>


    </div>
</div>

<a data-toggle="modal" id="mailAtBtn" href="#tblMailAt" class="" style="display:none"></a>
<div class="modal fade bs-modal-lg" id="tblMailAt" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title"><b>E-Mail: </b> </h4>
            </div>
            <div class="modal-body">

                <div class="col-md-12">
                    <div class="note note-info">
                        <p> Not: Çoklu girmek için aralarına virgül koyunuz.. </p>
                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 4px">
                    <label class="control-label col-md-3" style="text-align: left; padding-top: 10px">Mail Adresleri Giriniz:</label>
                    <div class="col-md-9" style="margin-bottom: 4px">
                        <input type="text" id="txtMailAdresleri" class="form-control" />
                    </div>
                </div>
                <div class="clearfix"></div>
            </div>
            <div class="modal-footer">
                <button type="button" id="btnMailKapat" class="btn default" data-dismiss="modal">Kapat</button>
                <button type="button" id="btnMailGonder" class="btn default" data-dismiss="modal">Gönder</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
