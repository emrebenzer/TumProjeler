<link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/plugins/jstree/dist/themes/default/style.min.css")"/>
<link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/jquery.datetimepicker.css")"/>
<script src="@Url.Content("~/Content/jquery.datetimepicker.js")" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function () {
        MESAJLAR();
        NERDEYIM();
        PERSONEL();
        $(".dropdown-quick-sidebar-toggler .dropdown-toggle .icon-logout").bind('click', function (e) {
            MESAJLAR();
            NERDEYIM();
            PERSONEL();
        });
        $('#BAS_T').datetimepicker({
            lang: 'tr'
        });
        $('#BIT_T').datetimepicker({
            lang: 'tr'
        });
        $("#PERSONEL_LIST").val("-1");
        setInterval(function () {
            FARK_GUNCELLE();
            MESAJLAR_FARK_ZAMAN();
        }, 2000);

        $("#KIM_MESAJ_UPDATE_BTN").bind('click', function (e) {
            if ($("#MESAJ_TXT").val() == "") {
                alert("Bu alana Giriş Yapmak Zorunludur");
                $("#MESAJ_TXT").parents(".form-group").addClass("form-group has-error");
                $("#MESAJ_TXT").focus();
                return false;
            } else {
                $("#MESAJ_TXT").parents(".form-group").removeClass().addClass("form-group");
            }
        });
        $("#KIM_NEREDE_UPDATE_BTN").bind('click', function (e) {
            if ($("#KONUM_TXT").val() == "") {
                alert("Bu alana Giriş Yapmak Zorunludur");
                $("#KONUM_TXT").parents(".form-group").addClass("form-group has-error");
                $("#KONUM_TXT").focus();
                return false;
            } else {
                $("#KONUM_TXT").parents(".form-group").removeClass().addClass("form-group");
            }
            if ($("#BAS_T").val() == "") {
                alert("Bu alana Giriş Yapmak Zorunludur");
                $("#BAS_T").parents(".form-group").addClass("form-group has-error");
                $("#BAS_T").focus();
                return false;
            } else {
                $("#BAS_T").parents(".form-group").removeClass().addClass("form-group");
            }
            if ($("#BIT_T").val() == "") {
                alert("Bu alana Giriş Yapmak Zorunludur");
                $("#BIT_T").parents(".form-group").addClass("form-group has-error");
                $("#BIT_T").focus();
                return false;
            } else {
                $("#BIT_T").parents(".form-group").removeClass().addClass("form-group");
            }
        });
    });
    function strpad00(s) {
        s = s + '';
        if (s.length === 1) s = '0' + s;
        return s;
    }
    function MESAJLAR_FARK_ZAMAN() {
        var currentdate = new Date();
        var datetime = currentdate.getDate()
            + "/" + strpad00((currentdate.getMonth() + 1))
            + "/" + currentdate.getFullYear()
            + " "
    + currentdate.getHours() + ":"
    + strpad00(currentdate.getMinutes()) + ":"
    + strpad00(currentdate.getSeconds());
        $('#MESAJLAR__UL_DIV li').each(function () {
            var BASLANGIC_Z = $(this).find(".MESAJ_ZAMAN_DIV").text();
            var SUAN_Z_FORMATLI = datetime;
            var sonuc = zaman_fark(SUAN_Z_FORMATLI.replace(".", "/").replace(".", "/"), BASLANGIC_Z.trim().replace(".", "/").replace(".", "/"));
            var BASLANGIC_Z_FORMATLI = new Date();
            BASLANGIC_Z_FORMATLI = BASLANGIC_Z.trim();
            var msj = "";
            var parca = sonuc.split("#");
            if (SUAN_Z_FORMATLI > BASLANGIC_Z_FORMATLI) {
                if (parca[0] != "") {
                    msj = parca[0] + "  " + parca[1] + " Önce";
                } else {
                    msj = "Yeni";
                }
            }
            if (msj == "Yeni") {
                $(this).find(".zamani_yazdir").css("color", "yellow");
            } else {
                $(this).find(".zamani_yazdir").removeAttr('style');
            }
            $(this).find(".zamani_yazdir").text("");
            $(this).find(".zamani_yazdir").text(msj);
        });
    }
    function FARK_GUNCELLE() {
        var currentdate = new Date();
        var datetime = currentdate.getDate()
            + "/" + strpad00((currentdate.getMonth() + 1))
            + "/" + currentdate.getFullYear()
            + " "
    + currentdate.getHours() + ":"
    + strpad00(currentdate.getMinutes()) + ":"
    + strpad00(currentdate.getSeconds());
        $('#PERSONEL_MESAJ_DIV li').each(function () {
            var BASLANGIC_Z = $(this).find(".media-heading-small").text();
            var SUAN_Z_FORMATLI = datetime;
            var sonuc = zaman_fark(SUAN_Z_FORMATLI.replace(".", "/").replace(".", "/"), BASLANGIC_Z.trim().replace(".", "/").replace(".", "/"));
            var BITIS_Z_FORMATLI = new Date();
            BITIS_Z_FORMATLI = $(this).find(".cc").val();
            var BASLANGIC_Z_FORMATLI = new Date();
            BASLANGIC_Z_FORMATLI = BASLANGIC_Z.trim();
            var msj = "";
            var parca = sonuc.split("#");
            if (SUAN_Z_FORMATLI > BASLANGIC_Z_FORMATLI) {
                if (BITIS_Z_FORMATLI > SUAN_Z_FORMATLI) {
                    msj = "Şuan orda";
                } else {
                    msj = parca[0] + "  " + parca[1] + " Önce";
                }
            } else {
                msj = "Henüz Ulaşmadı";
            }
            $(this).find(".datetime").text("");
            $(this).find(".datetime").text(msj);
        });
    }
    function zaman_fark(birinci, ikinci) {
        var beginDate = birinci.substr(10, 9).split(":");
        var endDate = ikinci.substr(10, 9).split(":");
        var b_Zaman = birinci.substr(0, 10).split("/");
        var bitis_Zaman = ikinci.substr(0, 10).split("/");
        var SAAT = "";
        var DAKIKA = "";
        var RNT = "";
        var GUN = "";
        var AY = "";
        var YIL = "";
        if (b_Zaman[2] > bitis_Zaman[2]) {
            YIL = b_Zaman[2] - bitis_Zaman[2];
        } else if (b_Zaman[2] < bitis_Zaman[2]) {
            YIL = bitis_Zaman[2] - b_Zaman[2];
        } else {
            YIL = "";
        }
        if (b_Zaman[1] > bitis_Zaman[1]) {
            AY = Math.round(b_Zaman[1] - bitis_Zaman[1]);
        } else if (b_Zaman[1] < bitis_Zaman[1]) {
            AY = Math.round(bitis_Zaman[1] - b_Zaman[1]);
        } else {
            AY = "";
        }
        if (b_Zaman[0] > bitis_Zaman[0]) {
            GUN = Math.round(b_Zaman[0] - bitis_Zaman[0]);
        } else if (b_Zaman[0] < bitis_Zaman[0]) {
            GUN = Math.round(bitis_Zaman[0] - b_Zaman[0]);
        } else {
            GUN = "";
        }
        if (beginDate[0] > endDate[0]) {
            SAAT = beginDate[0] - endDate[0];
        } else if (beginDate[0] < endDate[0]) {
            SAAT = endDate[0] - beginDate[0];
        } else {
            SAAT = 0;
        }
        if (beginDate[1] > endDate[1]) {
            DAKIKA = beginDate[1] - endDate[1];
        } else if (beginDate[1] < endDate[1]) {
            DAKIKA = endDate[1] - beginDate[1];
        } else {
            DAKIKA = 0;
        }
        if (YIL > 0) {
            RNT = YIL + "#Yıl";
        } else if (AY > 0) {
            RNT = AY + "#Ay";
        } else if (GUN > 0) {
            RNT = GUN + "#Gün";
        } else if (SAAT > 0) {
            RNT = SAAT + "#Saat";
        } else if (DAKIKA > 0) {
            RNT = DAKIKA + "#Dakika";
        }
        return RNT;
    }
    function MESAJLAR() {
        $('#MESAJLAR__UL_DIV').html("");
        $.ajax({
            url: '/Home/MESAJLAR',
            type: 'POST',
            data: JSON.stringify({ ID: "0" }),
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $.each(data, function (k, v) {
                    $('#MESAJLAR__UL_DIV').append('<li><div class="col1" style="margin-left:5px;margin-top:15px"><div class="cont"><div class="cont-col1"><div class="desc">' +
                    '<samp style="color: white;">' + v.GONDEREN_CARI + ' / </samp><span>' + v.GONDERIM_TIPI + '</span><br />' + v.ICERIK + '<div>' + v.GONDERIM_ZAMANI + '</div>' +
                    '<div class="zamani_yazdir"></div></div><div class="MESAJ_ZAMAN_DIV" style="display: none;">' + v.GONDERIM_ZAMANI + '</div></div></div></div></li>');
                });
            }
        });
    }
    function NERDEYIM() {
        $('#PERSONEL_MESAJ_DIV').html("");
        $.ajax({
            url: '/Home/NERDEYIM',
            type: 'POST',
            data: JSON.stringify({ ID: "0" }),
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $.each(data, function (k, v) {
                    $('#PERSONEL_MESAJ_DIV').append('<li class="media"><img class="media-object" src="../Img/' + v.RESIM_LINK + '"><div class="media-body"><h4 class="media-heading">' + v.AD + '</h4>' +
    '<div class="media-heading-sub" style="color: yellow;">' + v.ISIN_ACIKLAMASI + '</div><span class="datetime"></span><div class="media-heading-small">' + v.BULUNMA_BASLANGIC_TARIHI_SAATI
    + '<input type="hidden" value="' + v.DONUS_BASLANGIC_TARIHI_SAATI + '" class="cc"/></div></div></li>');
                });
            }
        });
    }
    function PERSONEL() {
        $('#PERSONEL_LIST').children().remove();
        $.ajax({
            url: '/Home/PERSONEL_LIST',
            type: 'POST',
            data: JSON.stringify({ ID: "#2" }),
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $.each(data, function (k, v) {
                    
                    $("#PERSONEL_LIST").append('<option value=' + v.Value + '>' + v.Text + '</option>');
                });
            }
        });
    }
</script>

<a href="javascript:;" class="page-quick-sidebar-toggler"><i class="icon-close"></i></a>
<div class="page-quick-sidebar-wrapper">
    <div class="page-quick-sidebar">
        <div class="nav-justified">
            <ul class="nav nav-tabs nav-justified">
                <li class="active">
                    <a href="#quick_sidebar_tab_1" data-toggle="tab">Mesaj</a>
                </li>
                <li>
                    <a href="#quick_sidebar_tab_2" data-toggle="tab">neredeyiz</a>
                </li>
                <li>
                    <a href="#quick_sidebar_tab_3" data-toggle="tab">KONUM</a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane active page-quick-sidebar-alerts" id="quick_sidebar_tab_1">
                    <div class="page-quick-sidebar-alerts-list">
                        @using (Ajax.BeginForm("KIM_MESAJ_UPDATE", "Home", new AjaxOptions { UpdateTargetId = "DAVA_UPDATE_FORM", InsertionMode = InsertionMode.Replace }))
                        { 
                            <div class="form-body">
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Mesaj</label>
                                    <div class="col-md-9">
                                        <input type="text" class="form-control" placeholder="Mesaj" name="MESAJ_TXT" id="MESAJ_TXT">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-md-3 control-label">Kime</label>
                                    <div class="col-md-9">
                                        <select class="form-control" id="PERSONEL_LIST" name="PERSONEL_LIST">
                                        </select>                                       
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-md-9" style="margin-top: 10px;">
                                        <button type="submit" class="btn green" id="KIM_MESAJ_UPDATE_BTN" name="KIM_MESAJ_UPDATE_BTN">Gönder</button>
                                    </div>
                                </div>
                            </div>
                        }
                        <ul class="feeds list-items" id="MESAJLAR__UL_DIV">
                        </ul>
                    </div>
                </div>
                <div class="tab-pane page-quick-sidebar-chat" id="quick_sidebar_tab_2">
                    <div class="page-quick-sidebar-chat-users" data-rail-color="#ddd" data-wrapper-class="page-quick-sidebar-list">
                        <h3 class="list-heading">Personel</h3>
                        <ul class="media-list list-items" id="PERSONEL_MESAJ_DIV">
                        </ul>
                    </div>
                    <div class="page-quick-sidebar-item">
                        <div class="page-quick-sidebar-chat-user">
                            <div class="page-quick-sidebar-nav">
                                <a href="javascript:;" class="page-quick-sidebar-back-to-list"><i class="icon-arrow-left"></i>Back</a>
                            </div>
                            <div class="page-quick-sidebar-chat-user-messages">
                                <div class="post out">
                                    <img class="avatar" alt="" src="../../assets/admin/layout/img/avatar3.jpg" />
                                    <div class="message">
                                        <span class="arrow"></span>
                                        <a href="#" class="name">Bob Nilson</a>
                                        <span class="datetime">20:15</span>
                                        <span class="body">When could you send me the report ? </span>
                                    </div>
                                </div>
                                <div class="post in">
                                    <img class="avatar" alt="" src="../../assets/admin/layout/img/avatar2.jpg" />
                                    <div class="message">
                                        <span class="arrow"></span>
                                        <a href="#" class="name">Ella Wong</a>
                                        <span class="datetime">20:15</span>
                                        <span class="body">Its almost done. I will be sending it shortly </span>
                                    </div>
                                </div>
                                <div class="post out">
                                    <img class="avatar" alt="" src="../../assets/admin/layout/img/avatar3.jpg" />
                                    <div class="message">
                                        <span class="arrow"></span>
                                        <a href="#" class="name">Bob Nilson</a>
                                        <span class="datetime">20:15</span>
                                        <span class="body">Alright. Thanks! :) </span>
                                    </div>
                                </div>
                                <div class="post in">
                                    <img class="avatar" alt="" src="../../assets/admin/layout/img/avatar2.jpg" />
                                    <div class="message">
                                        <span class="arrow"></span>
                                        <a href="#" class="name">Ella Wong</a>
                                        <span class="datetime">20:16</span>
                                        <span class="body">You are most welcome. Sorry for the delay. </span>
                                    </div>
                                </div>
                                <div class="post out">
                                    <img class="avatar" alt="" src="../../assets/admin/layout/img/avatar3.jpg" />
                                    <div class="message">
                                        <span class="arrow"></span>
                                        <a href="#" class="name">Bob Nilson</a>
                                        <span class="datetime">20:17</span>
                                        <span class="body">No probs. Just take your time :) </span>
                                    </div>
                                </div>
                                <div class="post in">
                                    <img class="avatar" alt="" src="../../assets/admin/layout/img/avatar2.jpg" />
                                    <div class="message">
                                        <span class="arrow"></span>
                                        <a href="#" class="name">Ella Wong</a>
                                        <span class="datetime">20:40</span>
                                        <span class="body">Alright. I just emailed it to you. </span>
                                    </div>
                                </div>
                                <div class="post out">
                                    <img class="avatar" alt="" src="../../assets/admin/layout/img/avatar3.jpg" />
                                    <div class="message">
                                        <span class="arrow"></span>
                                        <a href="#" class="name">Bob Nilson</a>
                                        <span class="datetime">20:17</span>
                                        <span class="body">Great! Thanks. Will check it right away. </span>
                                    </div>
                                </div>
                                <div class="post in">
                                    <img class="avatar" alt="" src="../../assets/admin/layout/img/avatar2.jpg" />
                                    <div class="message">
                                        <span class="arrow"></span>
                                        <a href="#" class="name">Ella Wong</a>
                                        <span class="datetime">20:40</span>
                                        <span class="body">Please let me know if you have any comment. </span>
                                    </div>
                                </div>
                                <div class="post out">
                                    <img class="avatar" alt="" src="../../assets/admin/layout/img/avatar3.jpg" />
                                    <div class="message">
                                        <span class="arrow"></span>
                                        <a href="#" class="name">Bob Nilson</a>
                                        <span class="datetime">20:17</span>
                                        <span class="body">Sure. I will check and buzz you if anything needs to be corrected. </span>
                                    </div>
                                </div>
                            </div>
                            <div class="page-quick-sidebar-chat-user-form">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="Type a message here...">
                                    <div class="input-group-btn">
                                        <button type="button" class="btn blue"><i class="icon-paper-clip"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane page-quick-sidebar-settings" id="quick_sidebar_tab_3">
                    <div class="page-quick-sidebar-settings-list">
                        @using (Ajax.BeginForm("KIM_NEREDE_UPDATE", "Home", new AjaxOptions { UpdateTargetId = "DAVA_UPDATE_FORM", InsertionMode = InsertionMode.Replace }))
                        { 
                            <div class="form-body">
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Konum</label>
                                    <div class="col-md-9">
                                        <input type="text" class="form-control" placeholder="Konum Girin" name="KONUM_TXT" id="KONUM_TXT">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Başlangıç T</label>
                                    <div class="col-md-9">
                                        <input type="text" class="form-control" placeholder="Başlangıc Zamanı" name="BAS_T" id="BAS_T">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Bitiş T</label>
                                    <div class="col-md-9">
                                        <input type="text" class="form-control" placeholder="Bitiş Zamanı" name="BIT_T" id="BIT_T">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-md-9" style="margin-top: 10px;">
                                        <button type="submit" class="btn green" id="KIM_NEREDE_UPDATE_BTN" name="KIM_NEREDE_UPDATE_BTN">Kaydet</button>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
